<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
  <meta name="description" content="POS - Bootstrap Admin Template">
  <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
  <meta name="author" content="Dreamguys - Bootstrap Admin Template">
  <meta name="robots" content="noindex, nofollow">
  <title>Control Shop - Admin</title>

  <link rel="shortcut icon" type="image/x-icon"  href="/images/img/icon.png">
  <link rel="stylesheet" href="/css/bootstrap.min.css">

  <link rel="stylesheet" href="/css/animate.css">

  <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="/plugins/icons/flags/flags.css">
  <link rel="stylesheet" href="/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="/plugins/simpleline/simple-line-icons.css">
  <link rel="stylesheet" href="/plugins/fontawesome/css/fontawesome.min.css">
  <link rel="stylesheet" href="/plugins/fontawesome/css/all.min.css">

  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="mini-sidebar">
<div id="global-loader">
  <div class="whirly-loader"></div>
</div>
<div class="main-wrapper">
  <div class="header">

    <div class="header-left active">
      <a href="/manage" class="logo">
        <img src="/images/img/logo.png" alt="">
      </a>
      <a href="/manage" class="logo-small">
        <img src="/images/img/logo-small.png" alt="">
      </a>
      <a id="toggle_btn" href="javascript:void(0);">
      </a>
    </div>

    <a id="mobile_btn" class="mobile_btn" href="#sidebar">
            <span class="bar-icon">
            <span></span>
            <span></span>
            <span></span>
            </span>
    </a>

    <ul class="nav user-menu">

      <li class="nav-item dropdown has-arrow flag-nav">
        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="javascript:void(0);" role="button">
          <i class="flag flag-vn"></i>
        </a>
      </li>

      <li class="nav-item dropdown">
        <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
          <img src="/images/img/icons/notification-bing.svg" alt="img"> <span
                class="badge rounded-pill" th:text="${soThongBao}"></span>
        </a>
        <div class="dropdown-menu notifications">
          <div class="topnav-dropdown-header">
            <span class="notification-title">Notifications</span>
            <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
          </div>
          <div class="noti-content">
            <ul class="notification-list">
              <th:block  th:each="x : ${listThongBao}">
                <li th:if="${x.trangThai == 3}"class="notification-message">
                  <a href="/manage/bill/online">
                    <div class="media d-flex">
                                        <span class="avatar flex-shrink-0">
                                        <img alt="" src="/images/img/profiles/avatar-02.jpg">
                                        </span>
                      <div class="media-body flex-grow-1">
                        <p class="noti-details" >
                          <span class="noti-title" th:text="${x.khachHang.hoTenKH}"></span>
                          <span th:text="${x.noiDungTB}"></span>
                          <span class="noti-title" th:text="${x.hoaDon.maHD}"></span>
                        </p>
                        <p class="noti-time">
                          <span class="notification-time"th:text="${#dates.format(x.tgTB, 'HH:mm yyyy-MM-dd')}"></span>
                        </p>
                      </div>
                    </div>
                  </a>
                </li>
              </th:block>
            </ul>
          </div>
          <div class="topnav-dropdown-footer">
            <a href="activities.html">View all Notifications</a>
          </div>
        </div>
      </li>

      <li class="nav-item dropdown has-arrow main-drop">
        <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                    <span class="user-img"><img th:src="@{'/images/imgsNhanVien/'+${session.managerLogged.AnhNV}}" alt="">
                    <span class="status online"></span></span>
        </a>
        <div class="dropdown-menu menu-drop-user">
          <div class="profilename">
            <div class="profileset">
                            <span class="user-img"><img th:src="@{'/images/imgsNhanVien/'+${session.managerLogged.AnhNV}}" alt="">
                            <span class="status online"></span></span>
              <div class="profilesets">
                <h6 th:text="${session.managerLogged.hoTenNV}"></h6>
                <h5 th:text="${session.managerLogged.chucVu.tenCV}"></h5>
              </div>
            </div>
            <hr class="m-0">
            <a class="dropdown-item" href="profile.html"> <i class="me-2" data-feather="user"></i> My
              Profile</a>
            <a class="dropdown-item" href="generalsettings.html"><i class="me-2"
                                                                    data-feather="settings"></i>Settings</a>
            <hr class="m-0">
            <a class="dropdown-item logout pb-0" href="/logout"><img src="/images/img/icons/log-out.svg"
                                                                     class="me-2" alt="img">Logout</a>
          </div>
        </div>
      </li>
    </ul>

    <div class="dropdown mobile-user-menu">
      <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
         aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
      <div class="dropdown-menu dropdown-menu-right">
        <a class="dropdown-item" href="profile.html">Thông tin cá nhân</a>
        <a class="dropdown-item" href="generalsettings.html">Cài đặt</a>
        <a class="dropdown-item" href="signin.html">Đăng xuất</a>
      </div>
    </div>

  </div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-inner slimscroll">
      <div id="sidebar-menu" class="sidebar-menu">
        <ul>
          <li>
            <a href="/manage/"><img src="/images/iconlogo.png" alt="img"><span>Trang chủ nè</span>
            </a>
          </li>
          <li>
            <a href="/manage/thongke"><img src="/images/img/icons/dashboard.svg" alt="img"><span> Thống Kê</span>
            </a>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);"><img src="/images/img/icons/product.svg" alt="img"><span> Quản lý Giày</span>
              <span class="menu-arrow"></span></a>
            <ul>
              <li><a href="/manage/chat-lieu">Chất Liệu</a></li>
              <li><a href="/manage/giay">Giày</a></li>
              <li><a href="/manage/hang">Hãng</a></li>
              <li><a href="/manage/hinh-anh">Hình Ảnh</a></li>
              <li><a href="/manage/mau-sac">Màu Sắc</a></li>
              <li><a href="/manage/size">Size</a></li>
              <li><a href="/manage/giay-chi-tiet">Chi Tiết Giày</a></li>
            </ul>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);"><img src="/images/img/icons/expense1.svg" alt="img"><span> Quản Lý Hóa Đơn</span>
              <span class="menu-arrow"></span></a>
            <ul>

              <li><a href="/manage/bill/online">Quản lý hóa đơn online</a></li>
            </ul>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);"><img src="/images/img/icons/users1.svg" alt="img"><span> Quản Lý Khách Hàng</span>
              <span class="menu-arrow"></span></a>
            <ul>
              <li><a href="/manage/khach-hang">Khách Hàng</a></li>
              <li><a href="/manage/dia-chi">Địa Chỉ </a></li>
              <li><a href="/manage/loai-khach-hang">Loại Khách Hàng</a></li>
            </ul>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);"><img src="/images/img/icons/purchase1.svg" alt="img"><span> Lịch sử thanh toán</span>
              <span class="menu-arrow"></span></a>
            <ul>
              <li><a href="/manage/history/delivery">Thanh toán tiền mặt</a></li>
              li><a href="/manage/history/pay">Thanh toán VN PAY </a></li>
            </ul>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);"><img src="/images/img/icons/users1.svg" alt="img"><span> Quản Lý Nhân Viên</span>
              <span class="menu-arrow"></span></a>
            <ul>
              <li><a href="/manage/chuc-vu">Chức Vụ</a></li>
              <li><a href="/manage/nhan-vien">Nhân Viên</a></li>
            </ul>
          </li>
          <li class="submenu">
            <a href="javascript:void(0);">
              <img src="/images/img/icons/transfer1.svg" alt="img"/>
              <span>Quản lý Khuyến Mãi</span>
              <span class="menu-arrow"></span>
            </a>
            <ul>
              <li><a href="/manage/voucher-product">Khuyến Mãi Sản Phẩm</a></li>
              <li><a href="/manage/voucher-bill">Khuyến Mãi Hóa Đơn</a></li>
              <li><a href="/manage/voucher-ship" class="active">Khuyến Mãi Giao Hàng</a></li>
            </ul>
          </li>
          <li>
            <a href="/manage/giao-hang"><i data-feather="layers"></i><span> Quản lý giao hàng</span> </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="page-wrapper">

    <div class="content">

      <div class="page-header">
        <div class="page-title">
          <h4>Voucher </h4>
          <h6>Quản lý Khuyến Mãi Giao Hàng</h6>
        </div>
        <div class="page-btn">
          <a class="btn btn-added"  href="javascript:void(0);" data-bs-toggle="modal"
             data-bs-target="#themKMM"><img src="/images/img/icons/plus.svg"
                                            alt="img" class="me-2">Thêm khuyến mãi mới</a>
        </div>
      </div>

      <div class="card">

        <div class="card-body">
          <!-- Nhan Ngu -->

          <div class="table-responsive">
            <table class="table datanew">
              <thead>
              <tr>
                <th style="background-color: #ff9f43; color: white;" >Mã Voucher</th>
                <th style="background-color: #ff9f43; color: white;">Tên Voucher</th>
                <th style="background-color: #ff9f43; color: white;">Loại Giảm</th>
                <th style="background-color: #ff9f43; color: white;">Ngày Bắt Đầu</th>
                <th style="background-color: #ff9f43; color: white;">Ngày Kết Thúc</th>
                <th style="background-color: #ff9f43; color: white;">Số Lượng</th>
                <th style="background-color: #ff9f43; color: white;">Lượt Dùng</th>
                <th style="background-color: #ff9f43; color: white;" >% Giảm (Max $)</th>
                <th style="background-color: #ff9f43; color: white;">ĐK Hóa Đơn</th>
                <th style="background-color: #ff9f43; color: white;">Trạng Thái</th>
                <th style="background-color: #ff9f43; color: white;">Action</th>
              </tr>
              </thead>
              <tbody>

              <th:block th:each="x : ${listKhuyenMai}">
                <tr>
                  <td th:text="${x.maKM}"></td>
                  <td class="ellipsis" th:text="${x.tenKM}"></td>
                  <td>
                    <p th:if="${x.loaiGiam == true}">Giá tiền</p>
                    <p th:unless="${x.loaiGiam == true}">Phần trăm</p>
                  </td>
                  <td th:text="${#dates.format(x.tgBatDau, 'HH:mm yyyy-MM-dd')}" ></td>
                  <td th:text="${#dates.format(x.tgKetThuc, 'HH:mm yyyy-MM-dd')}" ></td>
                  <td th:text="${x.soLuong}"></td>
                  <td th:text="${x.soLuongDaDung}"></td>
                  <td th:text="${x.phanTramGiam * 100} +' % ' + '( ' + '₫' + ${#numbers.formatDecimal(x.giaTienGiam, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')} + ' )'"></td>
                  <td th:text="'₫' + ${#numbers.formatDecimal(x.dieuKienKMBill, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')}"></td>
                  <td>
                    <p th:if="${x.trangThai == 1}">Hoạt Động</p>
                    <p th:unless="${x.trangThai == 1}">Không Hoạt Động</p>
                  </td>
                  <td style="padding-left: 25px;">
                    <i class="si si-speedometer"  th:data-bs-toggle="modal"
                       th:data-bs-target="'#modalXemLichSuSuDung' + ${x.idKM}"
                       style="cursor: pointer; margin: 0 10px 0 10px; color: #ff9f43;"></i>
                    <a href="javascript:void(0);"
                       th:data-bs-toggle="modal"
                       th:data-bs-target="'#detalKM' + ${x.idKM}">
                      <img src="/images/img/icons/edit.svg" alt="img">
                    </a>
                  </td>
                </tr>
              </th:block>


              </tbody>
            </table>
          </div>

        </div>

      </div>

    </div>

  </div>

</div>

<section>

  <!--  Modal Detail Voucher Bill Start-->

  <th:block th:each="khuyenMai: ${listKhuyenMai}">
    <form th:action="@{'/manage/voucher/voucher-shipping/update/' + ${khuyenMai.idKM}}" method="post">
      <div class="modal fade" th:id="'detalKM' + ${khuyenMai.idKM}" tabindex="-1" aria-labelledby="create" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 900px;">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Thông tin Voucher</h5>
              <a th:href="@{'/manage/voucher/statistics/' + ${khuyenMai.idKM}}">Xem thống kê</a>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label>Mã Voucher :</label>
                    <p style="font-size: 13pt; font-weight: 700;" th:text="${khuyenMai.maKM}" ></p>
                  </div>
                </div>

                <div class="col-lg-5 col-sm-12 col-12">
                  <div class="form-group">
                    <label>Tên Voucher :</label>
                    <input name="tenKM" th:value="${khuyenMai.tenKM}"
                           style="border: none; border-radius: 0px; border-bottom: 0.5px solid black; font-size: 12pt; font-weight: 600;">
                  </div>
                </div>

                <div class="col-lg-4 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;">Hình thức giảm giá</label>
                    <select  name="loaiGiam" th:attr="value=${khuyenMai.loaiGiam}" class="form-select">
                      <option th:value="false" th:selected="${khuyenMai.loaiGiam} == false">Giảm theo phần trăm</option>
                      <option th:value="true" th:selected="${khuyenMai.loaiGiam} == true">Giảm theo giá tiền</option>
                    </select>
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600; ">Thời gian bắt đầu :</label>
                    <div style="display: flex;">
                      <input name="ngayBatDau" type="date" th:value="${#dates.format(khuyenMai.tgBatDau, 'yyyy-MM-dd')}"
                             style="border: none; margin: 0 10px 8px 0; font-size: 13pt; cursor: pointer;">
                    </div>
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600; ">Thời gian kết thúc :</label>
                    <div style="display: flex;">
                      <input type="date" name="ngayKetThuc" th:value="${#dates.format(khuyenMai.tgKetThuc, 'yyyy-MM-dd')}"
                             style="border: none; margin: 0 10px 8px 0; font-size: 13pt; cursor: pointer;">
                    </div>

                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;"> Số lượng Khuyến Mãi</label>
                    <input name="soLuong" th:value="${khuyenMai.soLuong}"
                           class="form-control" type="number"
                           style=" width: 150px; margin: 0 10px 10px 0;">
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;"> Số tiền giảm giá </label>
                    <input name="soTienGiamGia"  th:value="${khuyenMai.giaTienGiam}"
                           class="form-control" type="number"
                           style=" width: 150px; margin: 0 10px 10px 0;">
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;">Trạng thái</label>
                    <select name="trangThai" th:attr="value=${khuyenMai.trangThai}" class="form-select">
                      <option th:value="1" th:selected="${khuyenMai.trangThai} == 1">Đang hoạt động</option>
                      <option th:value="0" th:selected="${khuyenMai.trangThai} == 0">Không hoạt động</option>
                    </select>
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;"> Phần trăm giảm </label>
                    <input name="phanTramGiam" class="form-control" type="number" th:value="${khuyenMai.phanTramGiam * 100}"
                           style=" width: 150px; margin: 0 10px 10px 0;">
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;"> Số tiền giảm tối đa </label>
                    <input name="soTienGiamToiDa"  class="form-control" type="number" th:value="${khuyenMai.giaTienGiam}"
                           style=" width: 150px; margin: 0 10px 10px 0;">
                  </div>
                </div>

                <div class="col-lg-3 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-size: 11pt; font-weight: 600;"> Điều kiện hóa đơn </label>
                    <input name="dieuKienKMHD" class="form-control" type="number" th:value="${khuyenMai.dieuKienKMBill}"
                           style=" width: 150px; margin: 0 10px 10px 0;">
                  </div>
                </div>

                <div class="col-lg-12 col-sm-12 col-12">
                  <div class="form-group">
                    <label style="font-weight: 600;"> Mô tả  </label>
                    <div style="display: flex;">
                      <textarea th:text="${khuyenMai.moTa}" name="moTa" id="" cols="30" rows="10"></textarea>
                    </div>
                  </div>
                </div>

              </div>
              <div class="col-lg-12">
                <button class="btn btn-submit me-2" type="submit">Thay đổi</button>
                <a class="btn btn-cancel" data-bs-dismiss="modal">Cancel</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </th:block>

  <!--  Modal Detail Voucher Bill End-->

  <!--  Mess Start-->
  <div th:if="${showModalMess}" class="modal fade" id="messAddThanhCong" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thành Công</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3 th:text="${thongBaoABC} + ' Voucher Ship thành công '"></h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--  Mess End-->

  <!--  Modal Add Voucher Bill Start-->

  <div class="modal fade" id="themKMM" tabindex="-1" aria-labelledby="create" aria-hidden="true">

    <form th:action="@{/manage/voucher/voucher-shipping/add}" method="post">

      <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 1000px;">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tạo mới khuyến mãi giao hàng</h5>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label>Mã Voucher :</label>
                  <p style="font-size: 13pt; font-weight: 700;">Tự sinh</p>
                </div>
              </div>

              <div class="col-lg-5 col-sm-12 col-12">
                <div class="form-group">
                  <label>Tên Voucher :</label>
                  <input id="tenVoucherAdd" name="tenKM"
                         style="border: none; border-radius: 0px; border-bottom: 0.5px solid black; font-size: 12pt; font-weight: 600;">
                </div>
              </div>

              <div class="col-lg-4 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;">Hình thức giảm giá</label>
                  <select name="loaiGiamAdd" class="form-select">
                    <option th:value="false">Giảm theo phần trăm</option>
                    <option th:value="true">Giảm theo giá tiền</option>
                  </select>
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600; ">Thời gian bắt đầu :</label>
                  <div style="display: flex;">
                    <input id="startDateAdd" name="dateStart" type="date"
                           style="border: none; margin: 0 10px 8px 0; font-size: 13pt; cursor: pointer;">
                  </div>
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600; ">Thời gian kết thúc :</label>
                  <div style="display: flex;">
                    <input id="endDateAdd" name="dateEnd" type="date"
                           style="border: none; margin: 0 10px 8px 0; font-size: 13pt; cursor: pointer;">
                  </div>

                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;"> Số lượng Khuyến Mãi</label>
                  <input id="soLuongKMAdd" name="soLuongKM" oninput="validateNumber(this)"
                         class="form-control" type="number"
                         style=" width: 150px; margin: 0 10px 10px 0;">
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;"> Số tiền giảm giá </label>
                  <input id="soTienGiamGiaAdd" name="soTienGiamGia" oninput="validateNumber(this)"
                         class="form-control" type="number"
                         style=" width: 150px; margin: 0 10px 10px 0;">
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;">Trạng thái</label>
                  <select name="trangThaiAdd" class="form-select">
                    <option value="0">Không hoạt động</option>
                    <option value="1">Hoạt Động</option>
                  </select>
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;"> Phần trăm giảm </label>
                  <input id="phanTramGiamVoucherAdd" name="phanTramGiam"
                         oninput="validateNumber(this)" class="form-control" type="number"
                         style=" width: 150px; margin: 0 10px 10px 0;">
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;"> Số tiền giảm tối đa </label>
                  <input id="soTienGiamGiaTDVoucherAdd" name="soTienToiDa"
                         oninput="validateNumber(this)" class="form-control" type="number"
                         style=" width: 150px; margin: 0 10px 10px 0;">
                </div>
              </div>

              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;"> Điều kiện hóa đơn </label>
                  <input id="dieuKienVoucherAdd" name="dieuKienKMHD"
                         oninput="validateNumber(this)" class="form-control" type="number"
                         style=" width: 150px; margin: 0 10px 10px 0;">
                </div>
              </div>

              <div class="col-lg-12 col-sm-12 col-12">
                <div class="form-group">
                  <label style="font-size: 11pt; font-weight: 600;">Mô tả </label>
                  <textarea id="moTaVoucherAdd" name="moTa" type="text"></textarea>
                </div>
              </div>

            </div>
            <div class="col-lg-12">
              <button class="btn btn-submit" style="background: #3088df;" type="submit" onclick="validateDateRange()">Thêm</button>
              <a class="btn btn-cancel" data-bs-dismiss="modal">Cancel</a>
            </div>
          </div>
        </div>
      </div>

    </form>

  </div>

  <!--  Modal Add Voucher Bill End-->

  <div th:if="${showSoLuongKhuyenMaiHetHan}" class="modal fade" id="showSoLuongKhuyenMaiHetHan" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thành Công</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3 th:text="'Có ' + ${soLuongKhuyenMaiHetHan} + ' khuyến mãi đã hết hạn sử dụng'"></h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errThem1" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thông báo</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3>Vui lòng nhập đầy đủ và đúng định dạng cho các trường !</h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errThem2" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thông báo</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3>Ngày kết thúc phải lớn hơn ngày bắt đầu !</h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errThem3" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thông báo</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3>Ngày kết thúc phải lớn hơn thời gian hiện tại !</h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errThem4" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width: 500px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thông báo</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row" style="text-align: center; align-items: center; padding: 30px 0 30px 0;">
            <div>
              <h3>Phần trăm voucher phải nhỏ hơn 50, số tiền voucher và số tiền tối đa voucher phải nhỏ hơn 1,000,000 !</h3>
            </div>
          </div>
          <div class="col-lg-12">
            <a class="btn btn-submit" style="background: #3088df;" data-bs-dismiss="modal">OK</a>
          </div>
        </div>
      </div>
    </div>
  </div>


</section>

<script>
  function validateDateRange() {
    var startDateValue = document.getElementById('startDateAdd').value;
    var endDateValue = document.getElementById('endDateAdd').value;
    var tenVoucherAddValue = document.getElementById('tenVoucherAdd').value;
    var moTaVoucherAddValue = document.getElementById('moTaVoucherAdd').value;
    var soTienVoucherAdd = parseFloat(document.getElementById('soTienGiamGiaAdd').value);
    var soTienToiDaVoucherAdd = parseFloat(document.getElementById('soTienGiamGiaTDVoucherAdd').value);
    var phanTramVoucherAdd = parseFloat(document.getElementById('phanTramGiamVoucherAdd').value);

    if (!tenVoucherAddValue || !moTaVoucherAddValue || isNaN(soTienVoucherAdd) || isNaN(soTienToiDaVoucherAdd) || isNaN(phanTramVoucherAdd) || !startDateValue || !endDateValue) {
      $('#errThem1').modal('show');
      event.preventDefault();
    }

    var startDate = new Date(startDateValue);
    var endDate = new Date(endDateValue);
    var currentDate = new Date(); // Thời gian hiện tại

    // Kiểm tra nếu ngày kết thúc nhỏ hơn hoặc bằng ngày bắt đầu
    if (endDate <= startDate) {
      $('#errThem2').modal('show');
      event.preventDefault();
    }

    // Kiểm tra ngày kết thúc có lớn hơn thời gian hiện tại không
    if (endDate <= currentDate) {
      $('#errThem3').modal('show');
      event.preventDefault();
    }

    // Kiểm tra điều kiện cho phanTramVoucherAdd, soTienVoucherAdd, soTienToiDaVoucherAdd
    if (phanTramVoucherAdd >= 50 || soTienVoucherAdd >= 1000000 || soTienToiDaVoucherAdd >= 1000000) {
      $('#errThem4').modal('show');
      event.preventDefault();
    }
  }
</script>

<!-- Modal detail Hóa Đơn begin-->
<th:block th:each="x: ${listKhuyenMai}">
  <div class="modal fade" th:id="'modalXemLichSuSuDung' + ${x.idKM}" tabindex="-1" aria-labelledby="create" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document" style="width: 900px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Lịch sử sử dụng khuyến mãi</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">


            <div class="col-lg-3 col-sm-12 col-12">
              <div class="form-group">
                <label style="border: none; font-size: 12pt; font-weight: 600;">Mã Hóa Đơn</label>
              </div>
            </div>
            <div class="col-lg-3 col-sm-12 col-12">
              <div class="form-group">
                <label style="border: none; font-size: 12pt; font-weight: 600;">Tổng tiền hóa đơn</label>
              </div>
            </div>
            <div class="col-lg-3 col-sm-12 col-12">
              <div class="form-group">
                <label style="border: none; font-size: 12pt; font-weight: 600;">Thời gian sử dụng</label>
              </div>
            </div>
            <div class="col-lg-3 col-sm-12 col-12">
              <div class="form-group">
                <label style="border: none; font-size: 12pt; font-weight: 600;">Số tiền được giảm</label>
              </div>
            </div>

            <!-- So lan thay doi -->
            <th:block th:each="xx: ${x.khuyenMaiChiTietHoaDons}">
              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <p th:text="${xx.hoaDon.maHD}"></p>
                </div>
              </div>
              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <p th:text="'₫' + ${#numbers.formatDecimal(xx.hoaDon.tongTien, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')}"></p>
                </div>
              </div>
              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <p th:text="${#dates.format(xx.tgThem, 'HH:mm yyyy-MM-dd')}" ></p>
                </div>
              </div>
              <div class="col-lg-3 col-sm-12 col-12">
                <div class="form-group">
                  <p th:text="'₫' + ${#numbers.formatDecimal(xx.soTienGiam, 0, 'COMMA', 2, 'POINT').replaceAll('([,.])0+$', '$1').replaceAll('\\.$', '')}"></p>
                </div>
              </div>
            </th:block>
            <!-- So lan thay doi -->

          </div>
          <div class="col-lg-12">
            <a class="btn btn-cancel" data-bs-dismiss="modal">Hủy hóa đơn</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</th:block>
<!-- Modal detail Hóa Đơn end-->

<script src="/js/jquery-3.6.0.min.js"></script>

<script src="/js/feather.min.js"></script>

<script src="/js/jquery.slimscroll.min.js"></script>

<script src="/js/jquery.dataTables.min.js"></script>
<script src="/js/dataTables.bootstrap4.min.js"></script>

<script src="/js/bootstrap.bundle.min.js"></script>

<script src="/js/moment.min.js"></script>
<script src="/js/bootstrap-datetimepicker.min.js"></script>

<script src="/plugins/select2/js/select2.min.js"></script>

<script src="/plugins/sweetalert/sweetalert2.all.min.js"></script>
<script src="/plugins/sweetalert/sweetalerts.min.js"></script>

<script src="/js/script.js"></script>
<script>
  $(document).ready(function () {
    $('#messAddThanhCong').modal('show');
  });
  $(document).ready(function () {
    $('#showSoLuongKhuyenMaiHetHan').modal('show');
  });
</script>
</body>
</html>